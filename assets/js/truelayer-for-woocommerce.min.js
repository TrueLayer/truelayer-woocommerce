(()=>{"use strict";class e{constructor(e,t,n){this.getIframe=()=>this.iframe||this.createIframe(),this.createIframe=()=>(this.iframe=document.createElement("iframe"),this.iframe.src=this.getUrl(),this.iframe.title="Hosted payment page - EPP",this.iframe.style.border="none",this.iframe.style.boxSizing="border-box",this.iframe.style.width="100%",this.iframe.style.height="100%",this.iframe.style.minWidth=this.environment.minWidth,this.iframe.style.minHeight=this.environment.minHeight,this.logger.log("created HPP iframe:",this.iframe.src),this.iframe),this.attachIframe=e=>{e.appendChild(this.getIframe()),this.logger.log("attached HPP iframe to:",e)},this.getUrl=()=>{var e;let t=this.environment.hppUrl;if(t+="mandate"===this.config.type?"/mandates":"/payments",t+=this.environment.mock?"-mock":"",this.config.language){if(this.config.language.length>2)throw new Error("Language passed in the wrong format. Accepted ISO 2 Letter Language Codes");t+=`?lng=${this.config.language}&`}return t+="#",t+=`web-sdk=${this.environment.version}`,t+=`&signup=${null!=(e=this.config.signup)&&e}`,t+=`&open_bank_in_new_tab=${!0===this.config.open_bank_in_new_tab}`,t+="mandate"===this.config.type?`&mandate_id=${this.config.mandate_id}`:`&payment_id=${this.config.payment_id}`,t+=`&resource_token=${this.config.resource_token}`,t+=`&return_uri=${this.config.return_uri}`,t},this.setConfig=e=>{if("payment"===e.type&&!e.payment_id)throw new Error("payment_id is required");if("mandate"===e.type&&!e.mandate_id)throw new Error("mandate_id is required");if(!e.resource_token)throw new Error("resource_token is required");if(!e.return_uri)throw new Error("return_uri is required");this.config=e},this.setConfig(t),this.environment=e,this.logger=n}}const t="641px",n="786px",i="304px",o="304px";class r{constructor(e,i){this.createModalElement=()=>{const e=document.createElement("div");return e.id="truelayer-modal",e.style.cssText="\n      box-sizing: border-box;\n      position: fixed;\n      display: flex;\n      z-index: 9999;\n      left: 0;\n      top: 0;\n      width: 100%;\n      height: 100%;\n      overflow: hidden;\n      margin: auto;\n      background-color: rgb(0,0,0);\n      background-color: rgba(0,0,0,0.6);\n      opacity: 0;\n      transition: all 0.5s ease-in;\n    ",e},this.createModalContentElement=()=>{const e=document.createElement("div");return e.id="truelayer-modal-content",e.style.cssText=`\n      box-sizing: border-box;\n      background-color: white;\n      border-radius: 5px;\n      padding: 0;\n      margin: auto;\n      border: 0px transparent;\n      width: ${this.environment.width};\n      height: ${this.environment.height};\n      max-height: 97vh;\n      overflow: hidden;\n      opacity: 0;\n      transform: scale(0.8);\n      transform-origin: center center;\n      transition: all 0.4s ease-in;\n      box-shadow: 0 0 0 1px rgb(17 20 24 / 10%), 0 2px 4px rgb(17 20 24 / 20%), 0 8px 24px rgb(17 20 24 / 20%);\n    `,e},this.mount=()=>(this.logger.log("modal appended to the DOM"),document.body.appendChild(this.modalElement),setTimeout((()=>{this.modalElement.style.opacity="1",this.modalContent.style.opacity="1",this.modalContent.style.transform="scale(1)"}),50),this.setBodyStyle(),this.setModalStyle(),window.addEventListener("resize",this.setModalStyle),this),this.unmount=()=>{this.modalElement.style.transition="all 0.2s ease-out",this.modalElement.style.opacity="0",this.modalContent.style.transition="all 0.2s ease-out",this.modalContent.innerHTML="",this.modalContent.style.opacity="0",this.modalContent.style.transform="scale(0.9)",setTimeout((()=>{this.logger.log("modal removed from the DOM"),this.modalElement.remove(),this.resetBodyStyle()}),200),window.removeEventListener("resize",this.setModalStyle)},this.setModalStyle=()=>{(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<=640?(this.modalContent.style.height="100%",this.modalContent.style.width="100%",this.modalContent.style.margin="8px"):(this.modalContent.style.height=n,this.modalContent.style.width=t,this.modalContent.style.margin="auto")},this.setBodyStyle=()=>{document.body.style.overflow="hidden"},this.resetBodyStyle=()=>{document.body.style.overflow="auto"},this.environment=e,this.logger=i,this.modalElement=this.createModalElement(),this.modalContent=this.createModalContentElement(),this.modalElement.appendChild(this.modalContent)}}var s=Object.defineProperty,a=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,d=(e,t,n)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;class c{constructor(e){this.win=null,this.subscribe=()=>{this.iframe.addEventListener("load",this.handleIframeLoad),window.addEventListener("message",this.handleEvent)},this.unsubscribe=()=>{this.iframe.removeEventListener("load",this.handleIframeLoad),window.removeEventListener("message",this.handleEvent)},this.handleIframeLoad=()=>{this.logger.log("hosted payment page loaded"),this.config.onLoad&&(this.logger.log("executing onLoad callback"),this.config.onLoad())},this.handHandoffStart=()=>{this.logger.log("hosted payment page start handoff"),this.config.onHandoffStart&&(this.logger.log("executing onHandoffStart callback"),this.config.onHandoffStart())},this.handleEvent=e=>{const t=e.data;if(e.origin===this.environment.hppUrl)if(e.data)if("[TRUELAYER]"===t.type)try{this.logger.info("event received",t.message,e),this.handleMessage(t)}catch(e){this.logger.error("error in message",e),this.config.onError&&this.config.onError(e)}else this.logger.error("data type not equal to [TRUELAYER]");else this.logger.error("unknown data in message",e);else this.logger.error("unknown origin",e)},this.handleMessage=e=>{var t;switch(e.message){case"HPP_DONE":return void this.handleDone();case"HPP_HANDOFF_START":return void this.handHandoffStart();case"CLOSE":return void this.handleClose();case"HPP_READY":return void this.handleHppReady();case"REDIRECT_TO_PROVIDER":const n=this.validateURL(e.provider_uri);return void(n&&(!0===this.config.open_bank_in_new_tab?(this.win=window.open(n,"_blank"),null==(t=this.win)||t.focus(),this.config.onOpenBankInNewTab&&this.config.onOpenBankInNewTab()):window.location.href=n));case"HPP_ERROR_DISMISSED":return void this.handleErrorDismiss();default:return void this.logger.log("Unknown message type")}},this.handleClose=()=>{this.cleanUp(),this.config.onAbort&&(this.logger.log("executing onAbort callback"),this.config.onAbort(this.config.target))},this.handleErrorDismiss=()=>{this.cleanUp(),this.config.onErrorDismiss&&(this.logger.log("executing onErrorDismiss callback"),this.config.onErrorDismiss(this.config.target))},this.handleDone=()=>{this.cleanUp(),this.config.onDone&&(this.logger.log("executing onDone callback"),this.config.onDone(this.config.target))},this.handleHppReady=()=>{var e;!function(e,t,n){!function(e,t,n,i){var o;null==(o=e.contentWindow)||o.postMessage(((e,t)=>{for(var n in t||(t={}))h.call(t,n)&&d(e,n,t[n]);if(a)for(var n of a(t))l.call(t,n)&&d(e,n,t[n]);return e})({type:"[TRUELAYER]",message:"CUSTOM_APPEARANCE",date:Date.now()},n),i)}(e,0,{appearance:t},n)}(this.iframe,null!=(e=this.config.appearance)?e:{},this.environment.hppUrl)},this.cleanUp=()=>{var e;null==(e=this.win)||e.close(),this.unmount&&this.unmount(),this.unsubscribe(),this.logger.log("cleaned up")},this.validateURL=e=>e.startsWith("https")?e:(this.logger.log("uri is not valid",e),this.config.onError&&this.config.onError(new Error("uri is not valid")),void this.cleanUp()),this.environment=e.environment,this.config=e.config,this.iframe=e.hppClient.getIframe(),this.logger=e.logger,this.unmount=e.unmount}}const g=()=>{};function m(e){return"undefined"!=typeof window&&e?{log:u(window.console.log),warn:u(window.console.warn),info:u(window.console.info),error:u(window.console.error)}:{log:g,warn:g,info:g,error:g}}function u(e){const t="[SDK]";return(...n)=>{1===n.length&&"string"==typeof n[0]?e(`${t} ${n[0]}`):e(t,...n)}}var f=Object.defineProperty,p=Object.defineProperties,y=Object.getOwnPropertyDescriptors,w=Object.getOwnPropertySymbols,b=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable,E=(e,t,n)=>t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,_=(e,t)=>{for(var n in t||(t={}))b.call(t,n)&&E(e,n,t[n]);if(w)for(var n of w(t))v.call(t,n)&&E(e,n,t[n]);return e};function C(s){if(!s)throw new Error("config is required");let a=m(s.debug_mode);return a.log("configured with",s),{start:h=>{const l=_(_({},s),h);a=m(l.debug_mode);try{a.log("started with",l),function(s,a){const h=function(e){const r=e.production?"https://payment.truelayer.com":"https://payment.truelayer-sandbox.com";if(!r)throw new Error("EPP version or HPP url missing");return{hppUrl:r,version:"0.2.14",mock:"true"==="undefined".toLowerCase(),width:t,height:n,minWidth:i,minHeight:o}}(s);let l,d=s.target;if(!d){const e=new r(h,a);d=e.mount().modalContent,l=e.unmount}const g=new e(h,s,a);g.attachIframe(d),new c({environment:h,config:s,hppClient:g,logger:a,unmount:l}).subscribe()}(l,a)}catch(e){a.log("error",e),l.onError&&l.onError(e)}}}}jQuery((function(e){var t={init:function(){window.addEventListener("hashchange",t.handleHashChange)},handleHashChange:function(){var e=location.hash;if(0===e.indexOf("#truelayer=")){var n=decodeURIComponent(e.replace("#truelayer=","")),i=new URL(n),o=new URLSearchParams(i.search),r=o.get("payment_id"),s=o.get("token");t.initializeEpp(i.href,r,s)}},initializeEpp:function(e,t,n){var i=function(e){return C(((e,t)=>p(e,y(t)))(_({},e),{type:"payment"}))}({payment_id:t,resource_token:n,return_uri:e,production:"no"===truelayerParams.testmode,onAbort:function(){var t=e+"&error=tl_hpp_cancel";window.location.href=t},onError:function(t){var n=e+"&error=tl_hpp_error";window.location.href=n}});i.start()}};t.init()}))})();
//# sourceMappingURL=truelayer-for-woocommerce.min.js.map